<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="description" content="" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
    <!-- The above 4 meta tags *must* come first in the head; any other head content must come *after* these tags -->

    <!-- Title -->
    <title>WEVEN - your vending machine</title>

    <!-- Favicon -->
    <link rel="icon" href="img/core-img/favicon.ico" />

    <!-- Style CSS -->
    <link rel="stylesheet" href="/css/style.css" />

    <!--manifest.json-->
    <link rel="manifest" href="/manifest.json" />

    <!--animation-->

    <script>
        if ("serviceWorker.js" in navigator) {
            console.log("Will service worker register?");
            navigator.serviceWorker
                .register("service-worker.js")
                .then(function(reg) {
                    console.log("yes it did.");
                })
                .catch(function(err) {
                    console.log("No it didn,t This happened: ", err);
                });
        }
    </script>

    <!-- margin是調整border外的邊界；padding則是調整border內到內文之間的距離-->
    <style type="text/css">
        html,
        body,
        #map-canvas {
            height: 100%;
            margin: 0;
            padding: 20;
        }
        
        .infoImg {
            width: 200px;
            margin: 8px 0;
        }
        
        .infoDiv div {
            margin: 10px 0;
            width: 70px;
            height: 40px;
            background: url('http://example.oxxostudio.tw/it2016/it2016-day22-btn.jpg');
            cursor: pointer;
            background-position: -70px 0;
        }
    </style>
    <!---The async attribute allows the browser to render the page while the API loads--->
    <script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBstjRsNEnzJo4CYLYDSMu7lJ_Bu-A9w4c&callback=initMap">
    </script>

    <script src="https://unpkg.com/@google/markerclustererplus@4.0.1/dist/markerclustererplus.min.js"></script>

    <script type="text/javascript">
        function initMap() {
            var markers = [];
            var infoWindows = [];
            var infoWindow = [];

            navigator.geolocation.watchPosition((position) => {
                console.log(position.coords);
                var lat = position.coords.latitude;
                var lng = position.coords.longitude;
                // 載入路線服務與路線顯示圖層
                var directionsService = new google.maps.DirectionsService();
                var directionsDisplay = new google.maps.DirectionsRenderer();

                // 初始化地圖
                var map = new google.maps.Map(document.getElementById('map-canvas'), {
                    zoom: 18,
                    center: {
                        lat: lat,
                        lng: lng
                    }
                });
                var marker = new google.maps.Marker({
                    position: {
                        lat: lat,
                        lng: lng
                    },
                    map: map
                });

                // 放置路線圖層
                directionsDisplay.setMap(map);

                // 路線相關設定
                var request = {
                    origin: {
                        lat: lat,
                        lng: lng
                    },
                    destination: {
                        lat: 25.037906,
                        lng: 121.549781
                    },
                    travelMode: google.maps.TravelMode["WALKING"]
                };

                // 繪製路線
                directionsService.route(request, function(result, status) {
                    if (status == 'OK') {
                        // 回傳路線上每個步驟的細節
                        console.log(result.routes[0].legs[0].steps);
                        directionsDisplay.setDirections(result);
                    } else {
                        console.log(status);
                    }
                });

                var geocoder = new google.maps.Geocoder();
                console.log(geocoder);

                //info windows
                var info_config = [
                    '<div id="infoDiv0" class="infoDiv">' +
                    '  <h2>z販賣機1</h2>' +
                    '  <div class="list_item">' +
                    '<div class="item_img">' +
                    '<img src="/img/blog-img/4.jpg">' +
                    '</div>' +
                    '<div class="item_name text-center">' +
                    '<p>商品二</p>' +
                    '</div>' +
                    '<div class="item_info text-center">' +
                    '<p><span class="item_price">QQ</span>元，剩餘<span class="item_quantity">XX</span>個</p>' +
                    '</div>' +
                    '</div>',

                    '<div id="infoDiv0" class="infoDiv">' +
                    '  <h2>z販賣機1</h2>' +
                    '  <div class="list_item">' +
                    '<div class="item_img">' +
                    '<img src="/img/blog-img/4.jpg">' +
                    '</div>' +
                    '<div class="item_name text-center">' +
                    '<p>商品二</p>' +
                    '</div>' +
                    '<div class="item_info text-center">' +
                    '<p><span class="item_price">QQ</span>元，剩餘<span class="item_quantity">XX</span>個</p>' +
                    '</div>' +
                    '</div>',

                    '<div id="infoDiv0" class="infoDiv">' +
                    '  <h2>z販賣機1</h2>' +
                    '  <div class="list_item">' +
                    '<div class="item_img">' +
                    '<img src="/img/blog-img/4.jpg">' +
                    '</div>' +
                    '<div class="item_name text-center">' +
                    '<p>商品二</p>' +
                    '</div>' +
                    '<div class="item_info text-center">' +
                    '<p><span class="item_price">QQ</span>元，剩餘<span class="item_quantity">XX</span>個</p>' +
                    '</div>' +
                    '</div>',

                    '<div id="infoDiv0" class="infoDiv">' +
                    '  <h2>販賣機4</h2>' +
                    '  <span></span><br/>' +
                    '  <div></div>' +
                    '</div>',
                    '<div id="infoDiv0" class="infoDiv">' +
                    '  <h2>販賣機5</h2>' +
                    '  <span></span><br/>' +
                    '  <div></div>' +
                    '</div>',
                    '<div id="infoDiv0" class="infoDiv">' +
                    '  <h2>販賣機6</h2>' +
                    '  <span></span><br/>' +
                    '  <div></div>' +
                    '</div>',
                    '<div id="infoDiv0" class="infoDiv">' +
                    '  <h2>販賣機7</h2>' +
                    '  <span></span><br/>' +
                    '  <div></div>' +
                    '</div>',
                    '<div id="infoDiv0" class="infoDiv">' +
                    '  <h2>販賣機8</h2>' +
                    '  <span></span><br/>' +
                    '  <div></div>' +
                    '</div>',
                    '<div id="infoDiv0" class="infoDiv">' +
                    '  <h2>販賣機9</h2>' +
                    '  <span></span><br/>' +
                    '  <div></div>' +
                    '</div>',
                    '<div id="infoDiv0" class="infoDiv">' +
                    '  <h2>販賣機10</h2>' +
                    '  <span></span><br/>' +
                    '  <div></div>' +
                    '</div>',
                ];

                //建立地圖 marker 的集合
                var marker_config = [{
                    position: {
                        lat: 25.038000,
                        lng: 121.431927
                    },
                    map: map,
                    icon: 'img/marker.png',
                    title: '1'
                }, {
                    position: {
                        lat: 25.037342,
                        lng: 121.430894
                    },
                    map: map,
                    icon: 'img/marker.png',
                    title: '2'
                }, {
                    position: {
                        lat: 25.036023,
                        lng: 121.432333
                    },
                    map: map,
                    icon: 'img/marker.png',
                    title: '3'
                }, {
                    position: {
                        lat: 25.038759,
                        lng: 121.431430
                    },
                    map: map,
                    icon: 'img/marker.png',
                    title: '4'
                }, {
                    position: {
                        lat: 25.036061,
                        lng: 121.429154
                    },
                    map: map,
                    icon: 'img/marker.png',
                    title: '5'
                }, {
                    position: {
                        lat: 25.035939,
                        lng: 121.430465
                    },
                    map: map,
                    icon: 'img/marker.png',
                    title: '6'
                }, {
                    position: {
                        lat: 25.034948,
                        lng: 121.433882
                    },
                    map: map,
                    icon: 'img/marker.png',
                    title: '7'
                }, {
                    position: {
                        lat: 25.038934,
                        lng: 121.431146
                    },
                    map: map,
                    icon: 'img/marker.png',
                    title: '8'
                }, {
                    position: {
                        lat: 25.035079,
                        lng: 121.434370
                    },
                    map: map,
                    icon: 'img/marker.png',
                    title: '9'
                }, {
                    position: {
                        lat: 25.036645,
                        lng: 121.430537
                    },
                    map: map,
                    icon: 'img/marker.png',
                    title: '10'
                }];

                //設定 Info window 內容

                info_config.forEach(function(e, i) {
                    infoWindows[i] = new google.maps.InfoWindow({
                        content: e
                    });

                    //設定監聽事件，在資訊視窗準備好之後，就綁定對應的流程
                    google.maps.event.addListener(infoWindows[i], 'domready', function() {
                        _content(i);
                    });
                });


                //標出 marker
                marker_config.forEach(function(e, i) {
                    markers[i] = new google.maps.Marker(e);
                    markers[i].setMap(map);
                    markers[i].addListener('click', function() {
                        infoWindows[i].open(map, markers[i]);
                    });
                });






                console.log(_geocoder('高雄市'));
            });

        }
    </script>
</head>

<body>
    <!-- Preloader -->
    <div id="preloader">
        <div class="preload-content">
            <div id="original-load"></div>
        </div>
    </div>

    <!--Map-->
    <div id="map-canvas"></div>

    <footer>
        <!-- Link back to Colorlib can't be removed. Template is licensed under CC BY 3.0. -->
        Copyright &copy;
        <script>
            document.write(new Date().getFullYear());
        </script>
        All rights reserved | This template is made with
        <i class="fa fa-heart-o" aria-hidden="true"></i> by
        <a href="https://colorlib.com" target="_blank">Colorlib</a>
        <!-- Link back to Colorlib can't be removed. Template is licensed under CC BY 3.0. -->
    </footer>
    <!-- ##### Footer Area End ##### -->

    <!-- jQuery (Necessary for All JavaScript Plugins) -->
    <script src="js/jquery/jquery-2.2.4.min.js"></script>
    <!-- Popper js -->
    <script src="js/popper.min.js"></script>
    <!-- Bootstrap js -->
    <script src="js/bootstrap.min.js"></script>
    <!-- Plugins js -->
    <script src="js/plugins.js"></script>
    <!-- Active js -->
    <script src="js/active.js"></script>
</body>

</html>